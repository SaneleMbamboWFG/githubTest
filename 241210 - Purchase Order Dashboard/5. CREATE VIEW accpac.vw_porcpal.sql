-- View: accpac.vw_porcpal

-- DROP VIEW accpac.vw_porcpal;

CREATE OR REPLACE VIEW accpac.vw_porcpal
 AS
 SELECT DISTINCT btrim(h.rcpnumber) AS rcpnumber,
    l.dayendseq,
    l.rcpahseq,
    l.rcpalseq,
    l.audtdate,
    l.audttime,
    l.audtuser,
    l.audtorg,
    l.transtype,
    l.oeonumber,
    l.itemexists,
    l.itemno,
    l.location,
    l.itemdesc,
    l.cntlacct,
    l.taxclass1,
    l.taxclass2,
    l.taxclass3,
    l.taxclass4,
    l.taxclass5,
    l.rqreceived,
    l.rqcanceled,
    l.rcpunit,
    l.conversion,
    l.costconv,
    l.sqreceived,
    l.stockunit,
    l.costunit,
    l.unitcost,
    l.prunitcost,
    l.loadedcost,
    l.recentcost,
    l.fcextended,
    l.scextended,
    l.fcbaseallo,
    l.scbaseallo,
    l.fctaxallo,
    l.sctaxallo,
    l.fcprorated,
    l.scprorated,
    l.fctaxincl,
    l.sctaxincl,
    l.fctaxexcl,
    l.sctaxexcl,
    l.fcmprorate,
    l.scmprorate,
    l.taxbase1,
    l.taxbase2,
    l.taxbase3,
    l.taxbase4,
    l.taxbase5,
    l.taxinclud1,
    l.taxinclud2,
    l.taxinclud3,
    l.taxinclud4,
    l.taxinclud5,
    l.taxamount1,
    l.taxamount2,
    l.taxamount3,
    l.taxamount4,
    l.taxamount5,
    l.txrecvamt1,
    l.txrecvamt2,
    l.txrecvamt3,
    l.txrecvamt4,
    l.txrecvamt5,
    l.txexpsamt1,
    l.txexpsamt2,
    l.txexpsamt3,
    l.txexpsamt4,
    l.txexpsamt5,
    l.glclearing,
    btrim(l.glitem::text) AS glitem,
    l.glisposted,
    l.rqrectotal,
    l.sqrectotal,
    l.fcexttotal,
    l.scexttotal,
    l.rcpdays,
    l.lastcost,
    l.stockitem,
    btrim(l.ponumber::text) AS ponumber,
    l.qivalinstk,
    l.discpct,
    l.fcdiscount,
    l.scdiscount,
    l.fcdisctot,
    l.scdisctot,
    l."VALUES",
    l.rcplseq,
    l.fctaxrecv,
    l.sctaxrecv,
    l.fctaxexps,
    l.sctaxexps,
    l.fctaxamt1,
    l.fctaxamt2,
    l.fctaxamt3,
    l.fctaxamt4,
    l.fctaxamt5,
    l.comment,
    l.contract,
    l.project,
    l.ccategory,
    l.costclass,
    l.billtype,
    l.billrate,
    l.billcurr,
    l.aritemno,
    l.arunit,
    l.rtgpercent,
    l.rtgdays,
    l.scrtgamt,
    l.scrtgamtot,
    l.rtgamtover,
    l.gloverhead,
    l.gllabor,
    l.fcovrhdamt,
    l.scovrhdamt,
    l.fclaboramt,
    l.sclaboramt,
    l.dfcunitcst,
    l.dscunitcst,
    l.dbillrate,
    l.pmtransnum,
    l.rctaxallo,
    l.rctaxrecv,
    l.rctaxexps,
    l.rctaxincl,
    l.taramount1,
    l.taramount2,
    l.taramount3,
    l.taramount4,
    l.taramount5,
    l.scraxallo,
    l.fcraxallo,
    l.scraxexps,
    l.fcraxexps,
    l.defextwght,
    l.totdefexwt,
    l.dqreceived,
    l.deltaconve,
    l.deltaunit,
    l.detailnum,
    (btrim(l.ponumber::text) || l.dayendseq) || l.rcpahseq AS po_key,
    replace(replace(btrim(l.glitem::text), '-'::text, ''::text), "left"(replace(btrim(l.glitem::text), '-'::text, ''::text), 5), ''::text) AS cost_centre
   FROM accpac.porcpal l
     LEFT JOIN accpac.vw_porcpah h ON btrim(h.ponumber) = btrim(l.ponumber::text)
  WHERE l.audtdate > 20201231::numeric;

